<!DOCTYPE html>
<!--[if lt IE 9 ]><html class="no-js ie" lang="en" itemscope itemtype="http://schema.org/{% case template %}{% when 'product' %}Product{% when 'blog' %}Blog{% else %}LocalBusiness{% endcase %}" xmlns:fb="http://ogp.me/ns/fb#"><![endif]-->
<!--[if (gte IE 9)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en" itemscope itemtype="http://schema.org/{% case template %}{% when 'product' %}Product{% when 'blog' %}Blog{% else %}LocalBusiness{% endcase %}" prefix="og:http://ogp.me/ns#">
<!--<![endif]-->
<head>
  {% include 'meta' %}
  {{ 'font-squirrel.css' | asset_url | stylesheet_tag }}
  {{ 'mangled.scss.css' | asset_url | stylesheet_tag }}
  {% if template contains 'customers' %}
    {{ 'customer.css' | asset_url | stylesheet_tag }}
  {% endif %}
  {{ 'modernizr.js' | asset_url | script_tag }}
</head>
<body id="{{ page_title | handle }}" class="{% if customer %}customer-logged-in {% endif %}template-{% if template %}{{ template | replace: '.', ' ' | truncatewords: 1, '' | handle }}{% else %}app{% endif %}">
 <div class="container">
   <header role="banner" class="clearfix">
    <form action="/search" method="get" class="search-form" role="search">
      <input name="q" type="text" id="search-field" placeholder="Search..." class="hint">
      <input type="submit" id="search-submit" value="Search" />
    </form>
    {% if shop.customer_accounts_enabled %}
      <p class="customer-links">
        {% if customer %}
          Logged in as <a href="/account">{{ customer.first_name }}</a> · {{ 'Log out' | customer_logout_link }}
        {% else %}
          {{ 'Log in' | customer_login_link }}
          {% if shop.customer_accounts_optional %}
            or {{ 'Create an account' | customer_register_link }}
          {% endif %}
        {% endif %}
      </p>
    {% endif %}
    <p class="checkout-link">
      <a href="/cart">{{ cart.item_count }} {{ cart.item_count | pluralize: 'item', 'items' }} ({{ cart.total_price | money }})</a> ·
      <a href="/cart">Check out</a>
    </p>
    <a href="/"><img src="{{ 'logo.png' | asset_url }}" alt="{{ shop.name }}"></a>
    {% include 'main-nav' %}
   </header>
   <div role="main" class="main clearfix">
     {% if template %}
       {% if template == 'list-collections' %}
        {% include 'collection-listing' %}
       {% else %}
        {{ content_for_layout }}
       {% endif %}
     {% else %}{% comment %}app{% endcomment %}
      {{ content_for_layout }}
     {% endif %}

   </div>
   <footer role="contentinfo" class="clearfix">
     {% if linklists.footer.links.size > 0 %}
       <ul>
         {% for link in linklists.footer.links %}
          <li{% if link.active %} class="active"{% endif %}><a href="{{ link.url }}">{{ link.title }}</a></li>
         {% endfor %}
       </ul>
     {% endif %}
     <p>&copy; {{ "now" | date: "%Y" }} {{ shop.name }}. {{ powered_by_link }}. <a href="http://tricky3.co.uk/">Mangled by Tricky3</a></p>
   </footer>
 </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="{{ 'jquery.js' | asset_url }}">\x3C/script>')</script>
  {{ content_for_header }}
  {% if template contains 'customers' %}
    {{ 'shopify_common.js' | shopify_asset_url | script_tag }}
    {{ 'customer_area.js'  | shopify_asset_url | script_tag }}
    {% if template contains 'login' or template contains 'register' %}
      <script type="text/javascript">
      $(function(){
        SwitchCandy.Initialize();
      });
      var SwitchCandy = {
        Initialize:function(){
          var switches = $('.section-switcher');
          switches.bind("click", SwitchCandy.SwitchSection);
          switches.bind("touchstart", SwitchCandy.SwitchSection);
          SwitchCandy.LoadHashes();
        },
        LoadHashes:function(){
          switch(window.location.hash){
            case '#recover':
              $('.switch-toggle #existing-customer-switch').trigger('click');
              $('.section-switcher.recover-link').trigger('click');
            break;
            case '#new-customer':
              $('.switch-toggle #new-customer-switch').trigger('click');
            break;
            case '#guest':
              $('.switch-toggle #guest-switch').trigger('click');
            break;
            case '#customer':
              $('.switch-toggle #existing-customer-switch').trigger('click');
            break;
          }
        },
        SwitchSection:function(){
          $(".switchable-section").css('display','none');
          $('#'+$(this).attr('data-section-to-show')).css('display','block');
          if($(this).attr('href')){
            return false;
          }
          $(window).trigger('resize');//hack for android browser.
        }
      };
      </script>
    {% endif %}
  {% elsif template == 'product' %}
    {{ 'jquery.styledradios.js' | asset_url | script_tag }}
    <script type="text/javascript">
      var _Product = { product :{{ product | json }}};
      var _Cart =  null;
      $(function(){
        $('#product-select').StyledRadios({
          Product:_Product,
          VariantSelectedCallBack: RadioCallBack,
          SelectFirstAvailableVariant: false//play with this one.
        });

      });

      var RadioCallBack = function(variant,util){
        //console.log(variant);
        if(_Cart == null){
          $.getJSON('/cart.js', function(cart){
            _Cart = cart;
            RadioCallBack(variant, util);
          });
        }

        var purchaseButton = $('#add');
        if (variant && variant.available == true && !IsVariant422Error(variant)) {
          //$('#product-price').html(util.FormatMoney(variant.price, '{{ shop.money_without_currency_format }}'));
          purchaseButton.removeAttr('disabled');
          purchaseButton.val('Add to Cart');
        }else {
          purchaseButton.attr('disabled', 'disabled');
          var message = variant ? "Sold Out" : "Not Available";
          var isAnythingSelected = false;
          $('.styled-radio-wrapper').each(function(){
            var optionName = $(this).attr('data-option');
            var isAnyRadioSelectedForThisOption = $('input[type="radio"].checked', $(this)).length;
            if(!isAnyRadioSelectedForThisOption){
              message = 'Please select the '+optionName;
              return false;
            }else{
            	isAnythingSelected = true;
            }
          });
          purchaseButton.val(isAnythingSelected ? message : 'Please select an option');
        }

      };

      var IsVariant422Error = function(variant){
          var cannotAddThisQuantity = false;
          var selectedVariantId = variant.id;
          var quantityToAdd = parseInt($('input[name="quantity"]').val(), 10) || 1;
          var quantityInCart = 0;
          var inventoryLimited = false;
          var inventory = 0;
          var cart = _Cart;

          if(variant.inventory_management && variant.inventory_policy == 'deny') {
            inventoryLimited = true;
            inventory = variant.inventory_quantity;
          }

          if(inventoryLimited){
              if(cart.item_count > 0){
                  for(var i=0;i<cart.items.length;i++){
                      quantityInCart = cart.items[i].id == selectedVariantId ? cart.items[i].quantity : quantityInCart;
                  }
              }

              if ((inventory - quantityInCart) < quantityToAdd) {
                  cannotAddThisQuantity = true;
              }
          }

          return cannotAddThisQuantity;
      };
    </script>
  {% elsif template == 'cart' %}
    <script type="text/javascript">
      function remove_item(id) {
          document.getElementById('updates_'+id).value = 0;
          document.getElementById('cartform').submit();
      }
      $(function(){
        $('.quantity-field').change(function(){
          var field = $(this);
          var maxQuantity = field.attr('data-product-inventory');
          var quantity = field.val();
          if(quantity > maxQuantity){
            field.val(maxQuantity);
            var quantityNotification = $('.quantity-notification', field.parent());
            if(quantityNotification.length == 0){
              quantityNotification = $('<i class="quantity-notification"/>');
              field.parent().append(quantityNotification);
            }
            var positionOfField = field.position();
            quantityNotification.css({'left':positionOfField.left+'px','top':positionOfField.top+25+'px'});
            quantityNotification.text('Only '+maxQuantity+' in stock');
            quantityNotification.fadeIn('fast');
            setTimeout(function(){
              quantityNotification.fadeOut('slow');
            },3000);
          }
        });
      });
    </script>
  {% endif %}

  <!--[if lt IE 8]>
    {{ 'json2.js' | asset_url | script_tag }}
  <![endif]-->

  <!--[if (lt IE 9) & (!IEMobile)]>
    {{ 'DOMAssistant.js' | asset_url | script_tag }}
    {{ 'selectivizr.js' | asset_url | script_tag }}
  <![endif]-->


</body>
</html>
